<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Game</title>
	{% include "components/styles.html"%}
	{% include "components/svgs.html"%}
	<meta http-equiv="refresh" content="3">
	{% set game_state_split = game.state.split(":")%}
	{% if game_state_split[0] == "2"%}
	<style>
		.rolling {
			animation: g-turn {{3*(1 - (game_state_split[1]|float / game_state_split[2]|float))}}s forwards cubic-bezier(.32,0,0,.94);
		}

		@keyframes g-turn {
		  from {
		  	transform: rotate(0turn);
		  }
		  to {transform: rotate({{game_state_split[2]|float}}turn);}
		}
	</style>
	{% elif game_state_split[0] == "3"%}
	<style>
		.finished {
			transform: rotate({{game_state_split[3]|float}}turn);
		}
	</style>
	{%endif%}
</head>
<body>
	{% if player %}
	<arcade-top-bar>
		<balance>
		{% include "components/balance.html"%}
		</balance>
	</arcade-top-bar>
	{% endif %}
	<a href="/arcade/iframe" class="back-to-arcade-a">Other Games</a>
	<main>
		<game-area>
			<current-hashed-secret>
				<current-spot-secret-time>{%if game.spot_secret != ""%}{%for spot in game.spots%}<div>{{spot.secret_time}}</div>{%endfor%}{% else %}No Current Spot Secret Times{%endif%}</current-spot-secret-time>
				<current-spot-secret>{%if game.spot_secret != ""%}{{game.spot_secret}}{% else %}No Current Spot Secret{%endif%}</current-spot-secret>
				<div>{{sha256(game.secret.encode()).hexdigest()}}</div>
				<div>Current Spot Secret Times / Current Spot Secret / Round Hashed Secret</div>
			</current-hashed-secret>
			<form action="/arcade/game/{{game.id}}/spot" method="post" class="g-choose-spots">
			<div class="game">
					<g-win-caret></g-win-caret>
					<g-inner>
					{% include "components/g-inner.html"%}
					</g-inner>
					<g-display {% if game_state_split[0] == "2"%}class="rolling"{% elif game_state_split[0] == "3"%}class="finished"{%endif%}>
						{% if game.spot_count == 4%}
						{% for i in range(1,5) %}
							{% set active_spot = {"spot":none} %}
							{% for spot in game.spots%}
								{% if spot.spot_num == i %}
									{% set _ = active_spot.update({'spot': spot}) %}
								{% endif %}
							{% endfor %}
							{% if active_spot.spot %}
								<g-4-{{i}} style="background: #{{config.USER_COLORS[active_spot.spot.player_id[:8]|int(base=16) % config.USER_COLORS|length]}}cc;  outline: none;" {% if game_state_split[0] == "3" and game_state_split[2]|int == active_spot.spot.spot_num %}class="win-spot">{{active_spot.spot.player.display[0:8]|capitalize}}{%else%}>
								{%endif%}</g-4-{{i}}>
							{% else %}
								<g-4-{{i}}><button type="submit" value="{{i}}" name="spot" class="choose-spot {% if game_state_split[0] == "3" and game_state_split[2]|int == taken_spots[i].spot_num%}choose-spot-active{%endif%}" style="border-color: rgba(255, 255, 255, 0);" {%if not player%}disabled{%endif%}>+</button></g-4-{{i}}>
							{% endif %}
						{% endfor %}
						{% elif game.spot_count == 2%}
							{% for i in range(1,3) %}
								{% set active_spot = {"spot":none} %}
								{% for spot in game.spots%}
									{% if spot.spot_num == i %}
										{% set _ = active_spot.update({'spot': spot}) %}
									{% endif %}
								{% endfor %}
								{% if active_spot.spot %}
									<g-2-{{i}} style="background: #{{config.USER_COLORS[active_spot.spot.player_id[:8]|int(base=16) % config.USER_COLORS|length]}}cc; outline: none;" {% if game_state_split[0] == "3" and game_state_split[2]|int == active_spot.spot.spot_num %}class="win-spot"><g-2-{{i}}-i>{{active_spot.spot.player.display[0:8]|capitalize}}{%else%}><g-2-{{i}}-i>{%endif%}</g-2-{{i}}-i></g-2-{{i}}>
								{% else %}
									<g-2-{{i}}><button type="submit" value="{{i}}" name="spot" class="choose-spot {% if game_state_split[0] == "3" and game_state_split[2]|int == taken_spots[i].spot_num%}choose-spot-active{%endif%}" style="border-color: rgba(255, 255, 255, 0);" {%if not player%}disabled{%endif%}><g-2-{{i}}-i>+</g-2-{{i}}-i></button></g-2-{{i}}>
								{% endif %}
							{% endfor %}
						{%endif%}
					</g-display>
				</div>
			</form>
			{% if game.last_game%}
			<last-secrets>
				<div><ls-lrhs>Last Round Hashed Secret</ls-lrhs> / <ls-lrs>Round Secret</ls-lrs> / <ls-lrs>Spot Secret</ls-lrs></div>
				<ls-lrhs>{{sha256(game.last_game.secret.encode()).hexdigest()}}</lrhs>
				<ls-lrs>{{game.last_game.secret}}</ls-lrs>
				<ls-lrs>{{game.last_game.spot_secret}}</ls-lrs>
			</last-secrets>
			{% endif %}
			<form action="/arcade/game/{{game.id}}/spot" method="post" class="choose-spots">
				{% for i in range(1, game.spot_count + 1) %}
					{% if i in taken_spots%}
					<claim-spot><button type="submit" value="{{i}}" name="spot" class="choose-spot {% if game_state_split[0] == "3" and game_state_split[2]|int == taken_spots[i].spot_num%}choose-spot-active{%endif%}" style="background: #{{config.USER_COLORS[taken_spots[i].player_id[:8]|int(base=16) % config.USER_COLORS|length]}}cc;border-color: rgba(255, 255, 255, 0);" disabled><wfp-t>{{taken_spots[i].player.display|capitalize}}</wfp-t>{%if bal_display == 'XMR'%}<claim-spot-xmr><g-xmr-i><svg height="12px" width="12px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-xmr-s"></use></svg></g-xmr-i>{{game.spot_cost}}</claim-spot-xmr>{%elif bal_display == 'USD'%}<claim-spot-usd><g-usd-i><svg height="12px" width="12px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-usd-s"></use></svg></g-usd-i>{{"{:,.2f}".format(game.spot_cost * curr_xmr_rate)}}</claim-spot-usd>{%endif%}</button></claim-spot>
					{% else %}
					<claim-spot><button type="submit" value="{{i}}" name="spot" class="choose-spot" {%if not player%}disabled{%endif%}><wfp>Waiting For Player...</wfp>{%if bal_display == 'XMR'%}<claim-spot-xmr><g-xmr-i><svg height="12px" width="12px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-xmr-s"></use></svg></g-xmr-i>{{game.spot_cost}}</claim-spot-xmr>{%elif bal_display == 'USD'%}<claim-spot-usd><g-usd-i><svg height="12px" width="12px"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-usd-s"></use></svg></g-usd-i>{{"{:,.2f}".format(game.spot_cost * curr_xmr_rate)}}</claim-spot-usd>{%endif%}</button></claim-spot>
					{% endif %}
				{% endfor %}
			</form>
		</game-area>
	</main>
</body>
</html>